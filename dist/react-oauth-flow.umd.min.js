!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","prop-types"],r):r(e.ReactOauthFlow={},e.React,e.PropTypes)}(this,function(e,r,t){"use strict";function n(e,r,t){if(null==r)return e;var n=void 0;return(n=null!=t?t(r):h.stringify(r))?e+(e.indexOf("?")<0?"?":"&")+n:e}t=t&&t.hasOwnProperty("default")?t.default:t;var o=function(e,r){return r={exports:{}},e(r,r.exports),r.exports}(function(e,r){var t=Object.prototype.hasOwnProperty,n=function(){for(var e=[],r=0;r<256;++r)e.push("%"+((r<16?"0":"")+r.toString(16)).toUpperCase());return e}();r.arrayToObject=function(e,r){for(var t=r&&r.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(t[n]=e[n]);return t},r.merge=function(e,n,o){if(!n)return e;if("object"!=typeof n){if(Array.isArray(e))e.push(n);else{if("object"!=typeof e)return[e,n];(o.plainObjects||o.allowPrototypes||!t.call(Object.prototype,n))&&(e[n]=!0)}return e}if("object"!=typeof e)return[e].concat(n);var i=e;return Array.isArray(e)&&!Array.isArray(n)&&(i=r.arrayToObject(e,o)),Array.isArray(e)&&Array.isArray(n)?(n.forEach(function(n,i){t.call(e,i)?e[i]&&"object"==typeof e[i]?e[i]=r.merge(e[i],n,o):e.push(n):e[i]=n}),e):Object.keys(n).reduce(function(e,i){var a=n[i];return t.call(e,i)?e[i]=r.merge(e[i],a,o):e[i]=a,e},i)},r.assign=function(e,r){return Object.keys(r).reduce(function(e,t){return e[t]=r[t],e},e)},r.decode=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(r){return e}},r.encode=function(e){if(0===e.length)return e;for(var r="string"==typeof e?e:String(e),t="",o=0;o<r.length;++o){var i=r.charCodeAt(o);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?t+=r.charAt(o):i<128?t+=n[i]:i<2048?t+=n[192|i>>6]+n[128|63&i]:i<55296||i>=57344?t+=n[224|i>>12]+n[128|i>>6&63]+n[128|63&i]:(o+=1,i=65536+((1023&i)<<10|1023&r.charCodeAt(o)),t+=n[240|i>>18]+n[128|i>>12&63]+n[128|i>>6&63]+n[128|63&i])}return t},r.compact=function(e){for(var r=[{obj:{o:e},prop:"o"}],t=[],n=0;n<r.length;++n)for(var o=r[n],i=o.obj[o.prop],a=Object.keys(i),c=0;c<a.length;++c){var l=a[c],u=i[l];"object"==typeof u&&null!==u&&-1===t.indexOf(u)&&(r.push({obj:i,prop:l}),t.push(u))}return function(e){for(var r;e.length;){var t=e.pop();if(r=t.obj[t.prop],Array.isArray(r)){for(var n=[],o=0;o<r.length;++o)void 0!==r[o]&&n.push(r[o]);t.obj[t.prop]=n}}return r}(r)},r.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},r.isBuffer=function(e){return null!==e&&void 0!==e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}}),i=(o.arrayToObject,o.merge,o.assign,o.decode,o.encode,o.compact,o.isRegExp,o.isBuffer,String.prototype.replace),a=/%20/g,c={default:"RFC3986",formatters:{RFC1738:function(e){return i.call(e,a,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"},l={brackets:function(e){return e+"[]"},indices:function(e,r){return e+"["+r+"]"},repeat:function(e){return e}},u=Date.prototype.toISOString,s={delimiter:"&",encode:!0,encoder:o.encode,encodeValuesOnly:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},p=function e(r,t,n,i,a,c,l,u,p,f,d,y){var h=r;if("function"==typeof l)h=l(t,h);else if(h instanceof Date)h=f(h);else if(null===h){if(i)return c&&!y?c(t,s.encoder):t;h=""}if("string"==typeof h||"number"==typeof h||"boolean"==typeof h||o.isBuffer(h)){if(c){return[d(y?t:c(t,s.encoder))+"="+d(c(h,s.encoder))]}return[d(t)+"="+d(String(h))]}var g=[];if(void 0===h)return g;var b;if(Array.isArray(l))b=l;else{var m=Object.keys(h);b=u?m.sort(u):m}for(var v=0;v<b.length;++v){var O=b[v];a&&null===h[O]||(g=Array.isArray(h)?g.concat(e(h[O],n(t,O),n,i,a,c,l,u,p,f,d,y)):g.concat(e(h[O],t+(p?"."+O:"["+O+"]"),n,i,a,c,l,u,p,f,d,y)))}return g},f=Object.prototype.hasOwnProperty,d={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:o.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},y=function(e,r,t){if(e){var n=t.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,i=/(\[[^[\]]*])/.exec(n),a=i?n.slice(0,i.index):n,c=[];if(a){if(!t.plainObjects&&f.call(Object.prototype,a)&&!t.allowPrototypes)return;c.push(a)}for(var l=0;null!==(i=o.exec(n))&&l<t.depth;){if(l+=1,!t.plainObjects&&f.call(Object.prototype,i[1].slice(1,-1))&&!t.allowPrototypes)return;c.push(i[1])}return i&&c.push("["+n.slice(i.index)+"]"),function(e,r,t){for(var n=r,o=e.length-1;o>=0;--o){var i,a=e[o];if("[]"===a)i=(i=[]).concat(n);else{i=t.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,l=parseInt(c,10);!isNaN(l)&&a!==c&&String(l)===c&&l>=0&&t.parseArrays&&l<=t.arrayLimit?(i=[])[l]=n:i[c]=n}n=i}return n}(c,r,t)}},h={formats:c,parse:function(e,r){var t=r?o.assign({},r):{};if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(t.ignoreQueryPrefix=!0===t.ignoreQueryPrefix,t.delimiter="string"==typeof t.delimiter||o.isRegExp(t.delimiter)?t.delimiter:d.delimiter,t.depth="number"==typeof t.depth?t.depth:d.depth,t.arrayLimit="number"==typeof t.arrayLimit?t.arrayLimit:d.arrayLimit,t.parseArrays=!1!==t.parseArrays,t.decoder="function"==typeof t.decoder?t.decoder:d.decoder,t.allowDots="boolean"==typeof t.allowDots?t.allowDots:d.allowDots,t.plainObjects="boolean"==typeof t.plainObjects?t.plainObjects:d.plainObjects,t.allowPrototypes="boolean"==typeof t.allowPrototypes?t.allowPrototypes:d.allowPrototypes,t.parameterLimit="number"==typeof t.parameterLimit?t.parameterLimit:d.parameterLimit,t.strictNullHandling="boolean"==typeof t.strictNullHandling?t.strictNullHandling:d.strictNullHandling,""===e||null===e||void 0===e)return t.plainObjects?Object.create(null):{};for(var n="string"==typeof e?function(e,r){for(var t={},n=r.ignoreQueryPrefix?e.replace(/^\?/,""):e,o=r.parameterLimit===1/0?void 0:r.parameterLimit,i=n.split(r.delimiter,o),a=0;a<i.length;++a){var c,l,u=i[a],s=u.indexOf("]="),p=-1===s?u.indexOf("="):s+1;-1===p?(c=r.decoder(u,d.decoder),l=r.strictNullHandling?null:""):(c=r.decoder(u.slice(0,p),d.decoder),l=r.decoder(u.slice(p+1),d.decoder)),f.call(t,c)?t[c]=[].concat(t[c]).concat(l):t[c]=l}return t}(e,t):e,i=t.plainObjects?Object.create(null):{},a=Object.keys(n),c=0;c<a.length;++c){var l=a[c],u=y(l,n[l],t);i=o.merge(i,u,t)}return o.compact(i)},stringify:function(e,r){var t=e,n=r?o.assign({},r):{};if(null!==n.encoder&&void 0!==n.encoder&&"function"!=typeof n.encoder)throw new TypeError("Encoder has to be a function.");var i=void 0===n.delimiter?s.delimiter:n.delimiter,a="boolean"==typeof n.strictNullHandling?n.strictNullHandling:s.strictNullHandling,u="boolean"==typeof n.skipNulls?n.skipNulls:s.skipNulls,f="boolean"==typeof n.encode?n.encode:s.encode,d="function"==typeof n.encoder?n.encoder:s.encoder,y="function"==typeof n.sort?n.sort:null,h=void 0!==n.allowDots&&n.allowDots,g="function"==typeof n.serializeDate?n.serializeDate:s.serializeDate,b="boolean"==typeof n.encodeValuesOnly?n.encodeValuesOnly:s.encodeValuesOnly;if(void 0===n.format)n.format=c.default;else if(!Object.prototype.hasOwnProperty.call(c.formatters,n.format))throw new TypeError("Unknown format option provided.");var m,v,O=c.formatters[n.format];"function"==typeof n.filter?t=(v=n.filter)("",t):Array.isArray(n.filter)&&(m=v=n.filter);var j=[];if("object"!=typeof t||null===t)return"";var w;w=n.arrayFormat in l?n.arrayFormat:"indices"in n?n.indices?"indices":"repeat":"indices";var A=l[w];m||(m=Object.keys(t)),y&&m.sort(y);for(var P=0;P<m.length;++P){var S=m[P];u&&null===t[S]||(j=j.concat(p(t[S],S,A,a,u,f?d:null,v,y,h,g,O,b)))}var k=j.join(i),x=!0===n.addQueryPrefix?"?":"";return k.length>0?x+k:""}},g=function(e,r,t){return Object.defineProperty(e,r,{enumerable:!1,configurable:!1,writable:!1,value:t}),e},b=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},m=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),v=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},O=function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)},j=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r},w=function(e){function t(){var e,r,n,o;b(this,t);for(var i=arguments.length,a=Array(i),c=0;c<i;c++)a[c]=arguments[c];return r=n=j(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),A.call(n),o=r,j(n,o)}return O(t,e),m(t,[{key:"componentDidMount",value:function(){this.getAuthorizationCode()}},{key:"render",value:function(){var e=this.props,t=e.component,n=e.render,o=e.children,i=this.state,a=i.processing,c=i.state,l=i.error;return null!=t?r.createElement(t,{processing:a,state:c,error:l}):null!=n?n({processing:a,state:c,error:l}):null!=o?(r.Children.only(o),o({processing:a,state:c,error:l})):null}}]),t}(r.Component);w.propTypes={tokenUrl:t.string.isRequired,clientId:t.string.isRequired,clientSecret:t.string.isRequired,redirectUri:t.string.isRequired,args:t.objectOf(t.oneOfType([t.string,t.number,t.bool,t.object])),location:t.shape({search:t.string.isRequired}),querystring:t.string,onAuthSuccess:t.func,onAuthError:t.func,render:t.func,tokenFetchArgs:t.shape({method:t.string}),component:t.element,children:t.func},w.defaultProps={args:{},location:null,querystring:null,onAuthSuccess:null,onAuthError:null,render:null,tokenFetchArgs:{},component:null,children:null};var A=function(){var e=this;this.state={processing:!0,state:null,error:null},this.getAuthorizationCode=function(){try{var r=e.props,t=r.tokenUrl,o=r.tokenFetchArgs,i=r.clientId,a=r.clientSecret,c=r.redirectUri,l=r.args,u=r.onAuthSuccess,s=e.parseQuerystring(),p=s.error,f=s.error_description,d=s.code,y=JSON.parse(s.state||null);if(y&&e.setState(function(){return{state:y}}),null!=p){throw new Error(f)}var h=n(""+t,v({code:d,grant_type:"authorization_code",client_id:i,client_secret:a,redirect_uri:c},l)),b=new Headers({"Content-Type":"application/json"});(function(e,r){var t=fetch(e,r);return t.then(function(e){if(!e.ok)throw e;return e.json()}).catch(function(e){return e.json().then(function(r){var n=new Error(e.statusText);throw g(n,"response",e),g(n.response,"data",r),g(n,"request",t),n})})})(h,Object.assign({method:"POST",headers:b},o)).then(function(r){var t=r.access_token;"function"==typeof u&&u(t,{response:r,state:y}),e.setState(function(){return{processing:!1}})}).catch(function(r){e.handleError(r),e.setState(function(){return{processing:!1}})})}catch(p){e.handleError(p),e.setState(function(){return{processing:!1}})}},this.handleError=function(r){var t=e.props.onAuthError;e.setState(function(){return{error:r}}),"function"==typeof t&&t(r)},this.parseQuerystring=function(){var r=e.props,t=r.location,n=r.querystring,o=void 0;return o=null!=t?t.search:null!=n?n:window.location.search,h.parse(o,{ignoreQueryPrefix:!0})}},P=function(e){function t(){return b(this,t),j(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return O(t,e),m(t,[{key:"render",value:function(){var e=this.props,t=e.authorizeUrl,o=e.clientId,i=e.redirectUri,a=e.state,c=e.args,l=e.render,u=e.component,s=e.children,p=n(""+t,v({client_id:o,redirect_uri:i,response_type:"code",state:a?JSON.stringify(a):void 0},c||{}));return null!=u?r.createElement(u,{url:p}):null!=l?l({url:p}):null!=s?(r.Children.only(s),s({url:p})):null}}]),t}(r.Component);P.propTypes={authorizeUrl:t.string.isRequired,clientId:t.string.isRequired,redirectUri:t.string.isRequired,state:t.objectOf(t.oneOfType([t.string,t.number,t.bool,t.object])),args:t.objectOf(t.oneOfType([t.string,t.number,t.bool,t.object])),render:t.func,component:t.element,children:t.func},P.defaultProps={state:null,args:null,render:null,component:null,children:null},e.createOauthFlow=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.authorizeUrl,n=e.tokenUrl,o=e.clientId,i=e.clientSecret,a=e.redirectUri,c=e.appName;return{Sender:function(e){return r.createElement(P,v({authorizeUrl:t,clientId:o,redirectUri:a},e))},Receiver:function(e){return r.createElement(w,v({tokenUrl:n,clientId:o,clientSecret:i,redirectUri:a,appName:c},e))}}},e.OauthSender=P,e.OauthReceiver=w,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=react-oauth-flow.umd.min.js.map
